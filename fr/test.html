<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../styletest.css" />
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Jockey+One&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="" />
    <title>Défi</title>
    <script src="https://kit.fontawesome.com/80cd6fff3b.js" crossorigin="anonymous"></script>
</head>

<body>
    <div class="container">
        <div class="center">
            <br>
            <h3 id="main">Remplissez la barre le plus vite possible</h3>
            <h5 id="sub">Le temps commence quand le fond clignote</h5>
            <h5 id="restart" class="pointer" onclick="setTimeout(start, 5000)"></h5>
        </div>
        <div class="vertical-center btnWrapper" style="display: flex; justify-content: center; align-items: center;">
            <div class="progress">
                <div id="bar1"></div>
            </div>
            <input class="bigbutton" type="submit"  id="submit" value="&#xf061" onclick="trigger()"></input>

            <div class="progress">
                <div id="bar2"></div>
            </div>
        </div>
    </div>

    <script>
        var height = 0, clicks = 0;
        var pushInterval = window.setInterval(downPush, 100);
        document.body.onload = setTimeout(start, 5000);
        var isStarted = false;
        var time;

        async function trigger() {
            if (isStarted) {
                clicks++;
                if (height < 100)
                height += 1;
            
                document.getElementById("bar1").style.height = document.getElementById("bar2").style.height = height + "%";
            }
            if (height >= 100)
            {
                stop();
            }
        }

        function downPush() {
            if (isStarted)
            {
                if (document.body.style.backgroundColor == "black")
                    document.body.style.backgroundColor = "#0d0d0e";
                else
                    document.body.style.backgroundColor = "black";
            }
            /* Remove for testing*/
            if (height > -1)
                document.getElementById("bar1").style.height = document.getElementById("bar2").style.height = (height-=0.4) + "%";
            if (height < 0.5)
                document.getElementById("bar1").style.height = document.getElementById("bar2").style.height = "0%";
            

        }
        function start() {isStarted = true; height = 0; clicks = 0; time = Date.now()}
        function stop()
        {
            document.getElementById("bar1").style.height = document.getElementById("bar2").style.height = "100%";
            document.body.style.backgroundColor = "#0d0d0e";
            time = Date.now() - time;
            document.getElementById("main").innerHTML = "Tu as cliqué " + clicks + " fois en " + (time / 1000) + " secondes!"
            document.getElementById("sub").innerHTML = "Ça te fait une moyenne de " + parseFloat((clicks / (time / 1000)).toFixed(2)) + " clics par seconde!";
            document.getElementById("restart").innerHTML = "<br>Recommencer?";
        }
    </script>
</body>

</html>